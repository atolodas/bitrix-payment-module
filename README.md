# Модуль оплаты beGateway для 1C-Битрикс

## Установка модуля

  * Создайте резервную копию вашего магазина и базы данных
  * Скачайте архив модуля [bitrix-begateway.zip](https://github.com/beGateway/bitrix-payment-module/raw/master/bitrix-begateway.zip)
  * Распакуйте архив и скопируйте каталог `devtm.begateway` в каталог
  `<1C-Bitrix/bitrix/modules/`
  * Зайдите в зону 1C-Битрикс администратора и выберите меню
  `Marketplace -> Установленные решения`
  * Установите модуль __Модуль платёжной системы на платформе beGateway__. Будет создана платежная система с обработчиками.

## Настройка модуля

  * Зайдите в зону 1C-Битрикс администратора и выберите меню `Магазин -> Настройки -> Платёжные системы`
  * Добавьте и настройте платёжную систему с обработчиком __Обработчик beGateway__
  * Зайдите в зону 1C-Битрикс администратора и выберите меню `Настройки -> Настройки продукта -> Модуль платёжной системы на платформе beGateway`
  * Введите в полях _Домен платёжного шлюза_, _Домен страницы оплаты_, _ID магазина_, _Ключ магазина_ значения, полученные от вашей платежной компании
  * Выберите в _Тип транзакции_ тип транзакции _Оплата_ (немедленное списание средств с карты) или _Авторизация_ (блокировка средств на карте). Уточните у вашей платёжной компании поддерживается ли с вашим банком-эквайером тип _Авторизация_.
  * Укажите в _Адрес страницы уведомления_ адрес страницы для уведомления, где был размещен и настроен компонент `sale.order.payment.receive`. В параметрах компонента указать тип плательщика и созданную платежную систему
  * Укажите в _Страница успешной оплаты_ адрес страницы куда будет перенаправлен покупатель в случае успешной оплаты. Добавьте там компонент `devtm:begateway.transaction.info` и настройках компонента установите параметр _Шаблон компонента_ в значение `success`
  * Укажите в _Страница неуспешной оплаты_ адрес страницы куда будет перенаправлен покупатель в случае неуспешной оплаты. Добавьте там компонент `devtm:begateway.transaction.info` и настройках компонента установите параметр _Шаблон компонента_ в значение `fail`
  * Укажите в _Страница возврата_ адрес страницы куда будет перенаправлен покупатель в случае если он решит отменить оплату.
  * Выберите в _Тип формы оплаты_ тип формы оплаты:
    * _Перенаправление_ - покупатель будет отправлен на сайт платёжной компании для ввода данных карты
    * _Встраиваемая_ - форма ввода данных карты будет отрисована внутри страницы магазина
    * _Всплывающая_ - форма ввода данных карты будет отрисована поверх страницы магазина
  * В случае _Встраиваемая_ и _Всплывающая_ можно передать свой CSS код в поле _CSS для всплывающей или встраиваемой формы_, чтобы отрисовать форму ввода данных карты в стиле интернет-магазина. Например, данный CSS скроет имя магазина и сделает кнопку подтверждения оплаты красной: `.shop-name { display:none; }  body#iframe #request .submit-button input { background-color: red; }`
  * Выберите в _Выберите систему оплаты_ платёжную систему, которую вы создали и настроили ранее
  * Выберите в _Выберите группу пользователей, которым будет доступно управление транзакциями_ группы пользователей, которые будут иметь права на просмотр транзакционных данных оплат и осуществлять на ними операции списания средств в случае _Авторизация_ или возврат средств обратно на карточку покупателя
  * Нажмите _Сохранить_

## Работа с транзакциями

Зайдите в зону 1C-Битрикс администратора и выберите меню `Сервисы -> Товары beGateway -> Список товаров`.

На этой страницы отображаются транзакции и допустимые над ними операции.

## Тестовые данные

Если вы настроете модуль со следующими значениями

  * Домен платёжного шлюза __demo-gateway.begateway.com__
  * Домен страницы оплаты __checkout.begateway.com__
  * Id магазина __361__
  * Секретный ключ магазина __b8647b68898b084b836474ed8d61ffe117c9a01168d867f24953b776ddcb134d__

то вы сможете уже
осуществить тестовый платеж в вашем магазине. Используйте следующие
данные тестовой карты:

  * номер карты __4200000000000000__
  * имя на карте __John Doe__
  * месяц срока действия карты __01__, чтобы получить успешный платеж
  * месяц срока действия карты __10__, чтобы получить неуспешный платеж
  * CVC __123__

## Примечания

Разработанно и протестированно с 1С-Битрикс 15.0.x/15.5.x
